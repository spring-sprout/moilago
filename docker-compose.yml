version: "3.3"

volumes:
  osoon_logs:
  osoon_test_logs:
  osoon_pgsql:
  osoon_test_pgsql:

services:
  pgsql:
    image: postgres:alpine
    environment:
      POSTGRES_USER: osoon
      POSTGRES_PASSWORD: osoon
      PGDATA: /data/postgres
    volumes:
      - osoon_pgsql:/data/postgres
      - ./src/main/resources/db-init.sql:/docker-entrypoint-initdb.d/10-init.sql
    ports:
      - "5432:5432"
    networks:
      - postgres
    restart: unless-stopped

  pgsql-test:
    image: postgres:alpine
    environment:
      POSTGRES_USER: osoon
      POSTGRES_PASSWORD: osoon
      PGDATA: /data/postgres
    volumes:
      - osoon_test_pgsql:/data/postgres
      - ./src/main/resources/db-init.sql:/docker-entrypoint-initdb.d/10-init.sql
    ports:
      - "6432:6432"
    networks:
      - postgres
    restart: unless-stopped

  backend:
    image: maven:3.5.2-jdk-8
    working_dir: /www
    command: mvn spring-boot:run
    ports:
      - "8080:8080"
    volumes:
      - ./src:/www/src
      - ./pom.xml:/www/pom.xml
    depends_on:
      - pgsql
    links:
      - pgsql:pgsql

  frontend:
    image: node:8.7.0
    working_dir: /www
    command: npm start
    ports:
      - "3000:3000"
    volumes:
      - ./web:/www
    depends_on:
      - backend
    links:
      - backend:backend

networks:
  postgres:
    driver: bridge
